{"ts":1370338665088,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\r\n\r\n\r\nvar ID_CONN_PAIR = [];\r\nvar mysqlConn;\r\nvar socket;\r\n\r\nvar StudentTools = require(\"./studentTools\");\r\n\r\n//**************\r\n// Functions\r\n//**************\r\nexports.call = function(_socket, received, _ID_CONN_PAIR, mysqlConnection){\r\n    \r\n    ID_CONN_PAIR = _ID_CONN_PAIR;\r\n    mysqlConn = mysqlConnection;\r\n    socket = _socket;\r\n    \r\n\t\r\n\tconsole.log(\"student controller call function\");\r\n    \r\n    \r\n\t//MessageNum에 따라서 분기 - 각각의 처리에 맞는 함수 호출\r\n\t    switch( parseInt(received.MessageNum, 10) ){\r\n\t\r\n    case StudentTools.CLIENT_REQUEST_LOGIN:\r\n        clientRequestLogin(received);\r\n\t\t\tbreak;\r\n\t\tcase 203:\r\n\t\t\tbreak;\r\n\t\tcase 205:\r\n\t\t\tbreak;\r\n\t\tcase 207: \r\n\t\t\tbreak;\r\n\t\tcase 209:\r\n\t\t\tbreak;\r\n\t\tcase 211:\r\n\t\t\tbreak;\r\n\t\tcase 213:\r\n\t\t\tbreak;\r\n\t\tcase 215:\r\n\t\t\tbreak;\r\n\t\tcase 217:\r\n\t\t\tbreak;\r\n\t\tcase 219:\r\n\t\t\tbreak;\r\n\t\tcase 221:\r\n\t\t\tbreak;\r\n\t\tcase 223:\r\n\t\t\tbreak;\r\n\t\tcase 225:\r\n\t\t\tbreak;\r\n\t\tcase 227:\r\n\t\t\tbreak;\r\n\t\tcase 229:\r\n\t\t\tbreak;\r\n\t\tcase 231:\r\n\t\t\tbreak;\r\n\t\tcase 233:\r\n\t\t\tbreak;\r\n\t\tcase 235:\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n}\r\n\r\n\r\nfunction clientRequestLogin(received){\r\n    \r\n    console.log( \"fuction clientRequestLogin \" );\r\n    \r\n    var res = StudentTools.newResponse();\r\n    res.MessageNum = StudentTools.SERVER_RESPONSE_LOGIN;\r\n    res.id = received.id;\r\n    res.success = 1; //별일 없으면 요청은 성공한다. \r\n    res.is_success = 0; //is_success 는 로그인을 성공했는가 이다. \r\n    \r\n    var query = \"select studentPw from latte_student where studentId = '\"+received.id+\"'\";\r\n    \r\n    mysqlConn.query(query, function (err, rows){\r\n    if(err){\r\n        console.log(\"mysql query err\");\r\n        console.log(err);\r\n        res.success = 0;\r\n    }\r\n    \r\n    else if( rows.length ) {\r\n         console.log( \" rrrr : \"+rows[0].studentPw);\r\n         \r\n         if( received.password == rows[0].studentPw){\r\n             res.is_success = 1;\r\n         }\r\n    }\r\n    //결과는 마이에스큐엘까지 끝난 다음 반환한다. \r\n        //결과 보내기\r\n        socket.emit('data', res) ;\r\n    \r\n    \r\n    });\r\n    \r\n}\r\n\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":1972}]],"length":1972}
