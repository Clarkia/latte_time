{"ts":1370275399292,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\r\n\r\nvar ID_CONN_PAIR = [];\r\nvar mysqlConn;\r\nvar socket;\r\n\r\nvar TeacherTools = require(\"./teacherTools\");\r\n\r\n\r\n//**************\r\n// Functions\r\n//**************\r\nexports.call = function(_socket, received, _ID_CONN_PAIR, mysqlConnection){\r\n\t\r\n    ID_CONN_PAIR = _ID_CONN_PAIR;\r\n    mysqlConn = mysqlConnection;\r\n    socket = _socket;\r\n    \r\n\tconsole.log(\"teacher controller call message : \"+received.MessageNum);\t\r\n\r\n\t//MessageNum에 따라서 분기 - 각각의 처리에 맞는 함수 호출\r\n\tswitch( parseInt(received.MessageNum, 10) ){\r\n\t\tcase TeacherTools.CLIENT_REQUEST_LOGIN :\r\n           clientRequestLogin(received);\r\n\t\t\tbreak;\r\n\t\tcase 103:\r\n\t\t\tbreak;\r\n\t\tcase 105:\r\n\t\t\tbreak;\r\n\t\tcase 107: \r\n\t\t\tbreak;\r\n\t\tcase 109:\r\n\t\t\tbreak;\r\n\t\tcase 111:\r\n\t\t\tbreak;\r\n\t\tcase 113:\r\n\t\t\tbreak;\r\n\t\tcase 115:\r\n\t\t\tbreak;\r\n\t\tcase 117:\r\n\t\t\tbreak;\r\n\t\tcase 119:\r\n\t\t\tbreak;\r\n\t\tcase 121:\r\n\t\t\tbreak;\r\n\t\tcase 123:\r\n\t\t\tbreak;\r\n\t\tcase 125:\r\n\t\t\tbreak;\r\n\t\tcase 127:\r\n\t\t\tbreak;\r\n\t\tcase 129:\r\n\t\t\tbreak;\r\n\t\tcase 131:\r\n\t\t\tbreak;\r\n\t\tcase 133:\r\n\t\t\tbreak;\r\n\t\tcase 135:\r\n\t\t\tbreak;\r\n\t\tcase 137:\r\n\t\t\tbreak;\r\n\t\tcase 139:\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n}\r\n\r\nfunction clientRequestLogin(received){\r\n    \r\n    console.log( \"fuction clientRequestLogin \" );\r\n    \r\n    var res = TeacherTools.newResponse();\r\n    res.MessageNum = TeacherTools.SERVER_RESPONSE_LOGIN;\r\n    res.id = received.id;\r\n    res.success = 1; //별일 없으면 요청은 성공한다. \r\n    res.is_success = 0; //is_success 는 로그인을 성공했는가 이다. \r\n    \r\n    var query = \"select teacherPw from latte_teacher where teacherId = '\"+received.id+\"'\";\r\n    \r\n    mysqlConn.query(query, function (err, rows){\r\n    if(err){\r\n        console.log(\"mysql query err\");\r\n        console.log(err);\r\n        res.success = 0;\r\n    }\r\n    \r\n    else if( rows.length ) {\r\n   \r\n         console.log( \" rrrr : \"+rows[0].teacherPw);\r\n         \r\n         if( received.password == rows[0].teacherPw){\r\n             res.is_success = 1;\r\n         }\r\n    }\r\n    \r\n    //결과는 마이에스큐엘까지 끝난 다음 반환한다. \r\n        //결과 보내기\r\n        socket.emit('data', res) ;\r\n    \r\n    \r\n    });\r\n    \r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":2027}]],"length":2027}
